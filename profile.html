<!DOCTYPE html>
<html>
  <head>
    <title>Ministore - User Profile</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/vendor.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      function loadHeaderFooter() {
        fetch('header.html')
          .then(response => response.text())
          .then(data => {
            document.getElementById('header-container').innerHTML = data;
          });

        fetch('footer.html')
          .then(response => response.text())
          .then(data => {
            document.getElementById('footer-container').innerHTML = data;
          });
      }
      window.onload = loadHeaderFooter;
    </script>
    <script src="js/modernizr.js"></script>
  </head>
  <body>
    <div id="header-container"></div>

    <!-- User Profile Section -->
    <section id="user-profile" class="padding-large">
      <div class="container">
        <div class="row">
          <!-- Profile Details -->
          <div class="col-lg-6 col-md-12">
            <div class="profile-card p-4 bg-light rounded">
              <h2 class="text-uppercase text-dark">Your Profile</h2>
              <p><strong>Name:</strong> <span id="user-name">John Doe</span></p>
              <p><strong>Email:</strong> <span id="user-email">johndoe@example.com</span></p>
              <p><strong>Contact:</strong> <span id="user-contact">+123456789</span></p>
              <button class="btn btn-dark text-uppercase btn-rounded-none mt-3" onclick="editProfile()">Edit Profile</button>
            </div>
          </div>

          <!-- Address Book -->
          <div class="col-lg-6 col-md-12">
            <div class="profile-card p-4 bg-light rounded">
              <h2 class="text-uppercase text-dark">Address Book</h2>
              <div id="address-book">
                <div class="address-item d-flex align-items-center justify-content-between p-2 border-bottom">
                  <div>
                    <p class="mb-0"><strong>123 Main St, Springfield</strong></p>
                    <small class="text-muted">Primary Address</small>
                  </div>
                  <div>
                    <button class="btn btn-sm btn-primary" disabled>Primary</button>
                    <button class="btn btn-sm btn-danger" onclick="removeAddress(this)">Remove</button>
                  </div>
                </div>
                <div class="address-item d-flex align-items-center justify-content-between p-2 border-bottom">
                  <div>
                    <p class="mb-0"><strong>456 Elm St, Shelbyville</strong></p>
                    <small class="text-muted">Secondary Address</small>
                  </div>
                  <div>
                    <button class="btn btn-sm btn-outline-secondary" onclick="setPrimary(this)">Set as Primary</button>
                    <button class="btn btn-sm btn-danger" onclick="removeAddress(this)">Remove</button>
                  </div>
                </div>
              </div>
              <button class="btn btn-dark text-uppercase btn-rounded-none mt-3 w-100" onclick="addAddress()">Add New Address</button>
            </div>
          </div>
        </div>

        <!-- Order History -->
        <div id="order-history-section" class="row mt-5">
          <div class="col-lg-12">
            <div class="profile-card p-4 bg-light rounded">
              <h2 class="text-uppercase text-dark">Order History</h2>
              <table class="table">
                <thead>
                  <tr>
                    <th>Order ID</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody id="order-history">
                  <tr>
                    <td><a href="#" onclick="showOrderDetails('#001')">#001</a></td>
                    <td>2025-01-01</td>
                    <td>Delivered</td>
                    <td>$100</td>
                  </tr>
                  <tr>
                    <td><a href="#" onclick="showOrderDetails('#002')">#002</a></td>
                    <td>2025-01-10</td>
                    <td>Processing</td>
                    <td>$200</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="js/plugins.js"></script>
    <script type="text/javascript" src="js/script.js"></script>
    <script>
      function setPrimary(button) {
        const addressItems = document.querySelectorAll('.address-item');

        addressItems.forEach((item) => {
          const primaryButton = item.querySelector('.btn-primary');
          if (primaryButton) {
            primaryButton.classList.replace('btn-primary', 'btn-outline-secondary');
            primaryButton.disabled = false;
            primaryButton.innerText = 'Set as Primary';
          }
          const label = item.querySelector('small');
          if (label) label.innerText = 'Secondary Address';
        });

        button.classList.replace('btn-outline-secondary', 'btn-primary');
        button.disabled = true;
        button.innerText = 'Primary';
        button.closest('.address-item').querySelector('small').innerText = 'Primary Address';
      }

      function removeAddress(button) {
        button.closest('.address-item').remove();
      }

      function addAddress() {
        const newAddress = prompt('Enter your new address:').trim();
        if (!newAddress || newAddress.length < 5) {
          alert('Please enter a valid address.');
          return;
        }

        const addressBook = document.getElementById('address-book');
        const addressHTML = `
          <div class="address-item d-flex align-items-center justify-content-between p-2 border-bottom">
            <div>
              <p class="mb-0"><strong>${newAddress}</strong></p>
              <small class="text-muted">Secondary Address</small>
            </div>
            <div>
              <button class="btn btn-sm btn-outline-secondary" onclick="setPrimary(this)">Set as Primary</button>
              <button class="btn btn-sm btn-danger" onclick="removeAddress(this)">Remove</button>
            </div>
          </div>
        `;
        addressBook.innerHTML += addressHTML;
      }

      function showOrderDetails(orderId) {
        window.location.href = `${window.location.origin}/order.html?orderId=${orderId}`;
      }

      function editProfile() {
        const nameField = document.getElementById('user-name');
        const emailField = document.getElementById('user-email');
        const contactField = document.getElementById('user-contact');
        const button = document.querySelector('.btn-dark');
        const cancelButtonId = 'cancel-edit-btn';

        alert(button.innerText === 'Edit Profile')
        if (button.innerText === 'Edit Profile') {
          // Save original values
          const nameValue = nameField.innerText.trim();
          const emailValue = emailField.innerText.trim();
          const contactValue = contactField.innerText.trim();

          // Replace spans with input fields
          nameField.outerHTML = `<input id="user-name" type="text" value="${nameValue}" class="form-control" />`;
          emailField.outerHTML = `<input id="user-email" type="email" value="${emailValue}" class="form-control" />`;
          contactField.outerHTML = `<input id="user-contact" type="text" value="${contactValue}" class="form-control" />`;

          button.innerText = 'Save Profile';

          // Add cancel button
          const cancelButton = document.createElement('button');
          cancelButton.id = cancelButtonId;
          cancelButton.className = 'btn btn-secondary text-uppercase btn-rounded-none mt-3 ms-2';
          cancelButton.innerText = 'Cancel';
          cancelButton.onclick = function () {
            cancelEditProfile(nameValue, emailValue, contactValue);
          };
          button.parentNode.appendChild(cancelButton);
        } else {
          // Save changes
          const updatedName = document.getElementById('user-name').value.trim();
          const updatedEmail = document.getElementById('user-email').value.trim();
          const updatedContact = document.getElementById('user-contact').value.trim();

          // Make an API call using Axios
          axios.post(`https://mini-store-api-ud3r.onrender.com/profile?id=${page}`, {
            name: updatedName,
            email: updatedEmail,
            contact: updatedContact,
          })
          .then(() => {
            // Replace input fields with spans
            document.getElementById('user-name').outerHTML = `<span id="user-name">${updatedName}</span>`;
            document.getElementById('user-email').outerHTML = `<span id="user-email">${updatedEmail}</span>`;
            document.getElementById('user-contact').outerHTML = `<span id="user-contact">${updatedContact}</span>`;

            // Update button and remove cancel button
            button.innerText = 'Edit Profile';
            const cancelButton = document.getElementById(cancelButtonId);
            if (cancelButton) cancelButton.remove();
          })
          .catch((error) => {
            console.error('Failed to update profile:', error);
            alert('Error updating profile. Please try again.');
          });
        }
      }

      function cancelEditProfile(originalName, originalEmail, originalContact) {
        // Restore original spans
        document.getElementById('user-name').outerHTML = `<span id="user-name">${originalName}</span>`;
        document.getElementById('user-email').outerHTML = `<span id="user-email">${originalEmail}</span>`;
        document.getElementById('user-contact').outerHTML = `<span id="user-contact">${originalContact}</span>`;

        // Update button and remove cancel button
        const button = document.querySelector('.btn-dark');
        if (button) button.innerText = 'Edit Profile';

        const cancelButton = document.getElementById('cancel-edit-btn');
        if (cancelButton) cancelButton.remove();
      }
    </script>
  </body>
</html>
