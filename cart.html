<!DOCTYPE html>
<html>
  <head>
    <title>Ministore</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <!-- script ================================================== -->
    <script>

      const token = localStorage.getItem("token");
      if(!token)
      {
        window.location.href = `${window.location.origin}/login.html`;
      }
      var decoded_token = jwt_decode(token);
      const id = decoded_token.userId;

      function loadHeaderFooter()
      {
        // Fetch and insert header content
        fetch('header.html')
          .then(response => response.text())
          .then(data => {
            document.getElementById('header-container').innerHTML = data;
          });

        // Fetch and insert footer content
        fetch('footer.html')
          .then(response => response.text())
          .then(data => {
            document.getElementById('footer-container').innerHTML = data;
          });
        }

      async function fetchCart(page) {
          try {
            const response = await axios.get(`https://mini-store-api-ud3r.onrender.com/carts`, {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            });
            const cartItems = response.data.data;

            // Populate the cart dynamically
            populateCart(cartItems);
          } catch (error) {
            console.error('Error fetching cart data:', error);
          }
        }
        
      function populateCart(cartItems) {
        const cartContainer = document.querySelector('.cart-table');
        cartContainer.innerHTML = '';

        cartItems.forEach((item) => {
          // Create a cart item element
          const cartItem = document.createElement('div');
          cartItem.classList.add('cart-item', 'border-top', 'border-bottom', 'padding-small');
          cartItem.setAttribute('data-cart-id', item.id);

          // Populate the cart item
          cartItem.innerHTML = `
            <div class="row align-items-center">
              <div class="col-lg-4 col-md-3">
                <div class="cart-info d-flex align-items-center">
                  <img src="${item.images[0]}" alt="${item.product_name}" class="img-fluid me-3" style="width: 60px;">
                  <div>
                    <h4 class="card-title text-uppercase mb-1">${item.product_name}</h4>
                    <span class="money text-primary">$${item.price.toFixed(2)}</span>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-md-4">
                <div class="qty-number">
                  <input class="spin-number-output text-center mx-2" type="text" readonly value="${item.qty}" style="width: 50px;">
                </div>
              </div>
              <div class="col-lg-4 col-md-4 text-end">
                <span class="money text-dark">$${(item.price * item.qty).toFixed(2)}</span>
              </div>
              <div class="col-lg-1 col-md-1 text-end">
                <a href="#" class="text-danger remove-item" data-cart-id="${item.id}">
                  <i class="bi bi-x-circle" style="font-size: 1.5rem;"></i>
                </a>
              </div>
            </div>
          `;

          // Append the cart item to the cart container
          cartContainer.appendChild(cartItem);
        });
      }
        
      function proceedToCheckOut() {
        window.location.href = `${window.location.origin}/checkout.html?id=${id}`;
      }

      // Call function to load header and footer
      window.onload = function () {
        loadHeaderFooter();
        fetchCart();
      };
    </script>
    <!-- script ================================================== -->
    <script src="js/modernizr.js"></script>
  </head>
  <div id="header-container"></div>
    <section class="hero-section position-relative bg-light-blue padding-medium">
      <div class="hero-content">
        <div class="container">
          <div class="row">
            <div class="text-center padding-large no-padding-bottom">
              <h1 class="display-2 text-uppercase text-dark">Cart</h1>
              <div class="breadcrumbs">
                <span class="item">
                  <a href="index.html">Home ></a>
                </span>
                <span class="item">Cart</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="shopify-cart padding-large">
      <div class="container">
        <div class="row">
          <div class="cart-table">
            
          </div>
          <div class="text-end mt-4">
            <button class="btn btn-light me-2">Continue Shopping</button>
            <button class="btn btn-primary" onclick='proceedToCheckOut()'>Proceed to Checkout</button>
          </div>
        </div>
      </div>
    </section>    
  <div id="footer-container"></div>
    <script src="js/jquery-1.11.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="js/plugins.js"></script>
    <script type="text/javascript" src="js/script.js"></script>
  </body>
</html>